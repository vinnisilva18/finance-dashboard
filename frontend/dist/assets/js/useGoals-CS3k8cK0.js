import{d as C,r as p,c as d}from"./vendor-kE9Pwckw.js";import{a as i}from"./index-CZQAM9fZ.js";import{l as F}from"./localStorageService-Bm_UUCrj.js";const P=C("goal",()=>{const t=p([]),n=p(!1),u=p(null),y=async()=>{n.value=!0,u.value=null;try{const e=await i.get("/goals");t.value=e.data}catch(e){u.value=e.message,console.error("Error fetching goals:",e)}finally{n.value=!1}},G=async e=>{try{const a=await i.post("/goals",e);return t.value.push(a.data),a.data}catch(a){throw console.error("Error creating goal:",a),a}},w=async e=>{try{const a=await i.put(`/goals/${e.id}`,e),s=t.value.findIndex(l=>l._id===e.id);return s!==-1&&(t.value[s]=a.data),a.data}catch(a){throw console.error("Error updating goal:",a),a}},A=async e=>{try{await i.delete(`/goals/${e}`),t.value=t.value.filter(a=>a._id!==e)}catch(a){throw console.error("Error deleting goal:",a),a}},_=async(e,a)=>{try{const s=await i.post(`/goals/${e}/progress`,{amount:a}),l=t.value.find($=>$._id===e);return l&&(l.currentAmount=s.data.currentAmount),s.data}catch(s){throw console.error("Error adding progress:",s),s}},f=async e=>{try{const a=await i.put(`/goals/${e}/archive`),s=t.value.findIndex(l=>l._id===e);return s!==-1&&(t.value[s]=a.data),a.data}catch(a){throw console.error("Error archiving goal:",a),a}},m=async e=>{try{const a=await i.put(`/goals/${e}/reactivate`),s=t.value.findIndex(l=>l._id===e);return s!==-1&&(t.value[s]=a.data),a.data}catch(a){throw console.error("Error reactivating goal:",a),a}},x=(e,a)=>{const s=t.value.find(l=>l._id===e);if(s&&s.milestones){const l=s.milestones.find($=>$.id===a);l&&(l.completed=!l.completed)}},E=e=>{t.value=e},S=e=>{t.value.push(e)},o=e=>t.value.find(a=>a._id===e),r=e=>t.value.filter(a=>a.priority===e),c=d(()=>t.value.filter(e=>!e.completed&&!e.archived)),v=d(()=>t.value.filter(e=>e.completed)),g=d(()=>t.value.filter(e=>!e.completed&&new Date(e.deadline)<new Date)),h=d(()=>t.value.filter(e=>e.archived));return{goals:t,loading:n,error:u,activeGoals:c,completedGoals:v,overdueGoals:g,archivedGoals:h,fetchGoals:y,createGoal:G,updateGoal:w,deleteGoal:A,addProgress:_,archiveGoal:f,reactivateGoal:m,toggleMilestone:x,setGoals:E,addGoal:S,getGoalById:o,getGoalsByPriority:r}}),b="goals",T=()=>{const t=P(),n=p(!1),u=p(null),y=async()=>{n.value=!0,u.value=null;try{const o=await i.get("/goals");t.setGoals(o.data)}catch{u.value="Failed to fetch goals";const r=F.getData(b)||[];t.setGoals(r)}finally{n.value=!1}},G=async o=>{n.value=!0;try{const r=await i.post("/goals",o);return t.addGoal(r.data),r.data}catch(r){throw u.value="Failed to add goal",r}finally{n.value=!1}},w=async(o,r)=>{n.value=!0;try{const c=await i.put(`/goals/${o}`,r),v=t.goals.findIndex(g=>g._id===o);return v!==-1&&t.goals.splice(v,1,c.data),c.data}catch(c){throw u.value="Failed to update goal",c}finally{n.value=!1}},A=async o=>{n.value=!0;try{await t.deleteGoal(o)}catch(r){throw u.value="Failed to delete goal",r}finally{n.value=!1}},_=async(o,r)=>{n.value=!0;try{const c=t.goals.find(e=>e._id===o);if(!c)return null;const v=Math.min(c.currentAmount+r,c.targetAmount),g=await i.patch(`/goals/${o}/progress`,{currentAmount:v}),h=t.goals.findIndex(e=>e._id===o);return h!==-1&&t.goals.splice(h,1,g.data),g.data}catch(c){throw u.value="Failed to add contribution",c}finally{n.value=!1}},f=d(()=>t.goals.reduce((o,r)=>o+r.targetAmount,0)),m=d(()=>t.goals.reduce((o,r)=>o+r.currentAmount,0)),x=d(()=>f.value>0?m.value/f.value:0),E=d(()=>t.goals.filter(o=>{const r=o.status||"active";return!(o.currentAmount>=o.targetAmount||r==="completed")&&!(r==="cancelled")})),S=d(()=>t.goals.filter(o=>{const r=o.status||"active";return o.currentAmount>=o.targetAmount||r==="completed"}));return{goals:d(()=>t.goals),activeGoals:E,completedGoals:S,loading:n,error:u,fetchGoals:y,addGoal:G,updateGoal:w,deleteGoal:A,addContribution:_,totalTargetAmount:f,totalCurrentAmount:m,totalProgress:x}};export{T as u};
