import{d as O,r as T,c as V,o as J,a as v,e,b as A,t as m,f as S,E as F,I,F as U,A as $,z as g,D as Y,J as G,m as y,n as E}from"./vendor-CeDlel3h.js";import{a as D,u as H}from"./category-_qF5EANa.js";import{a as K,f as Q}from"./formatters-B8MMj10x.js";import{_ as W}from"./index-Dv0HwUHl.js";import"./utils-B9ygI19o.js";const X=O("transaction",()=>{const c=T([]);return{transactions:c,setTransactions:p=>{c.value=p},addTransaction:p=>{c.value.unshift(p)},deleteTransaction:p=>{c.value=c.value.filter(b=>b.id!==p)},updateTransaction:(p,b)=>{const C=c.value.findIndex(o=>o.id===p);C!==-1&&(c.value[C]={...c.value[C],...b})}}}),Z=()=>{const c=X(),l=T(!1),d=T(null),w=async(o={})=>{var i,s;l.value=!0,d.value=null;try{const r=await D.get("/transactions",{params:o});c.setTransactions(r.data)}catch(r){throw d.value=((s=(i=r.response)==null?void 0:i.data)==null?void 0:s.message)||"Failed to fetch transactions",r}finally{l.value=!1}},x=async o=>{var i,s;l.value=!0,d.value=null;try{const r=await D.post("/transactions",o);return c.addTransaction(r.data),r.data}catch(r){throw d.value=((s=(i=r.response)==null?void 0:i.data)==null?void 0:s.message)||"Failed to add transaction",r}finally{l.value=!1}},p=async(o,i)=>{var s,r;l.value=!0,d.value=null;try{const f=await D.put(`/transactions/${o}`,i);return c.updateTransaction(o,f.data),f.data}catch(f){throw d.value=((r=(s=f.response)==null?void 0:s.data)==null?void 0:r.message)||"Failed to update transaction",f}finally{l.value=!1}},b=async o=>{var i,s;l.value=!0,d.value=null;try{await D.delete(`/transactions/${o}`),c.deleteTransaction(o)}catch(r){throw d.value=((s=(i=r.response)==null?void 0:i.data)==null?void 0:s.message)||"Failed to delete transaction",r}finally{l.value=!1}},C=async()=>{var o,i;l.value=!0,d.value=null;try{return(await D.get("/transactions/stats/summary")).data}catch(s){throw d.value=((i=(o=s.response)==null?void 0:o.data)==null?void 0:i.message)||"Failed to fetch transaction stats",s}finally{l.value=!1}};return{transactions:V(()=>c.transactions),loading:l,error:d,fetchTransactions:w,addTransaction:x,updateTransaction:p,deleteTransaction:b,getTransactionStats:C}},ee={class:"transactions"},te={class:"controls"},ae={key:0,class:"transaction-form card"},ne={class:"form-group"},oe={class:"form-group"},se={class:"form-group"},re={class:"form-group"},le={key:0},ie=["value"],ue={key:1},ce={class:"form-group"},de=["disabled"],pe={key:1,class:"loading"},ve={key:2,class:"error"},me={class:"transactions-list"},ye=["onClick"],fe={__name:"Transactions",props:{transactionType:{type:String,default:null}},setup(c){const l=c,{transactions:d,loading:w,error:x,fetchTransactions:p,addTransaction:b,deleteTransaction:C}=Z(),o=H(),i=T(!1),s=T(!1),r=T(!1),f=T(null),N=V(()=>l.transactionType==="income"?"Receitas":l.transactionType==="expense"?"Despesas":"Transações"),B=V(()=>l.transactionType?d.value.filter(u=>u.type===l.transactionType):d.value),L=V(()=>{const u=["Mercado","Transporte/Uber","Assinaturas","Remédios","Seguro de Celular","Shopping","Condomínio","Psicologia","Convênio","Plano Funerário","Enel","Financiamento","Internet","Lazer","Celular","Outros"],t=o.categories?o.categories.map(h=>h.name):[],a=B.value.map(h=>h.category);return[...new Set([...u,...t,...a].filter(Boolean))].sort()}),M=()=>{const u=new Date,t=u.getFullYear(),a=String(u.getMonth()+1).padStart(2,"0"),_=String(u.getDate()).padStart(2,"0");return`${t}-${a}-${_}`},n=T({description:"",amount:0,type:l.transactionType||"expense",category:"",date:M()});J(()=>{p(),o.fetchCategories&&o.fetchCategories()});const R=async()=>{var u;n.value.category==="__new__"&&(r.value=!0,n.value.category="",await G(),(u=f.value)==null||u.focus())},z=()=>{r.value=!1,n.value.category=""},j=async()=>{if(!n.value.date){alert("Por favor, selecione uma data válida.");return}i.value=!0;try{const[u,t,a]=n.value.date.split("-").map(Number),_=new Date(u,t-1,a,12,0,0);let h=n.value.category;const q=(o.categories||[]).find(k=>k.name===n.value.category);if(q)h=q.id;else if(n.value.category){const k=await o.createCategory({name:n.value.category,type:n.value.type});k&&k.id&&(h=k.id)}await b({...n.value,category:h,date:_,amount:n.value.type==="expense"?-Math.abs(n.value.amount):Math.abs(n.value.amount)}),n.value={description:"",amount:0,type:"expense",category:"",date:M()},r.value=!1,s.value=!1}catch(u){console.error("Error adding transaction:",u),alert("Erro ao adicionar transação. Verifique os dados e tente novamente.")}finally{i.value=!1}},P=async u=>{confirm("Tem certeza que deseja excluir esta transação?")&&await C(u)};return(u,t)=>(y(),v("div",ee,[e("h1",null,m(N.value),1),e("div",te,[e("button",{onClick:t[0]||(t[0]=a=>s.value=!s.value),class:"btn btn-primary"},m(s.value?"Cancelar":"Adicionar Transação"),1)]),s.value?(y(),v("div",ae,[t[15]||(t[15]=e("h3",null,"Adicionar Nova Transação",-1)),e("form",{onSubmit:Y(j,["prevent"])},[e("div",ne,[t[7]||(t[7]=e("label",null,"Descrição",-1)),S(e("input",{"onUpdate:modelValue":t[1]||(t[1]=a=>n.value.description=a),type:"text",required:"",class:"form-control"},null,512),[[F,n.value.description]])]),e("div",oe,[t[8]||(t[8]=e("label",null,"Valor",-1)),S(e("input",{"onUpdate:modelValue":t[2]||(t[2]=a=>n.value.amount=a),type:"number",step:"0.01",required:"",class:"form-control"},null,512),[[F,n.value.amount,void 0,{number:!0}]])]),e("div",se,[t[10]||(t[10]=e("label",null,"Tipo",-1)),S(e("select",{"onUpdate:modelValue":t[3]||(t[3]=a=>n.value.type=a),class:"form-control"},[...t[9]||(t[9]=[e("option",{value:"income"},"Receita",-1),e("option",{value:"expense"},"Despesa",-1)])],512),[[I,n.value.type]])]),e("div",re,[t[13]||(t[13]=e("label",null,"Categoria",-1)),r.value?(y(),v("div",ue,[S(e("input",{"onUpdate:modelValue":t[5]||(t[5]=a=>n.value.category=a),type:"text",required:"",class:"form-control",placeholder:"Nome da categoria",ref_key:"customCategoryInput",ref:f},null,512),[[F,n.value.category]]),e("button",{type:"button",onClick:z,class:"btn-link"},"Selecionar existente")])):(y(),v("div",le,[S(e("select",{"onUpdate:modelValue":t[4]||(t[4]=a=>n.value.category=a),class:"form-control",onChange:R,required:""},[t[11]||(t[11]=e("option",{value:"",disabled:""},"Selecione uma categoria",-1)),(y(!0),v(U,null,$(L.value,a=>(y(),v("option",{key:a,value:a},m(a),9,ie))),128)),t[12]||(t[12]=e("option",{value:"__new__"},"+ Nova Categoria",-1))],544),[[I,n.value.category]])]))]),e("div",ce,[t[14]||(t[14]=e("label",null,"Data",-1)),S(e("input",{"onUpdate:modelValue":t[6]||(t[6]=a=>n.value.date=a),type:"date",required:"",class:"form-control"},null,512),[[F,n.value.date]])]),e("button",{type:"submit",disabled:g(w)||i.value,class:"btn btn-primary"},m(g(w)||i.value?"Adicionando...":"Adicionar Transação"),9,de)],32)])):A("",!0),g(w)?(y(),v("div",pe,"Carregando...")):A("",!0),g(x)?(y(),v("div",ve,m(g(x)),1)):A("",!0),e("div",me,[e("table",null,[t[16]||(t[16]=e("thead",null,[e("tr",null,[e("th",null,"Data"),e("th",null,"Descrição"),e("th",null,"Categoria"),e("th",null,"Tipo"),e("th",null,"Valor"),e("th",null,"Ações")])],-1)),e("tbody",null,[(y(!0),v(U,null,$(g(d),a=>(y(),v("tr",{key:a.id},[e("td",null,m(g(K)(a.date)),1),e("td",null,m(a.description),1),e("td",null,m(a.category),1),e("td",null,[e("span",{class:E(["type-badge",a.type])},m(a.type==="income"?"Receita":"Despesa"),3)]),e("td",{class:E({negative:a.amount<0,positive:a.amount>0})},m(g(Q)(a.amount,"BRL")),3),e("td",null,[e("button",{onClick:_=>P(a.id),class:"btn btn-danger btn-sm"}," Excluir ",8,ye)])]))),128))])])])]))}},Se=W(fe,[["__scopeId","data-v-b77781fb"]]);export{Se as default};
