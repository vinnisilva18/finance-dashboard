import{c as Q,a as g,p,e as t,h as M,t as n,n as et,A as o,r as f,o as lt,w as ut,g as A,b as E,i as y,j as w,k as vt,F as H,B as J,m as mt}from"./vendor-kE9Pwckw.js";import{f as C,a as nt}from"./formatters-B8MMj10x.js";import{_ as ct,a as rt,u as gt}from"./index-C2foQiSO.js";import{u as pt}from"./useCategories-CvvNYS7B.js";import{u as ht}from"./useGoals-CB1BPfKQ.js";import{u as _t}from"./useCards-BHytCPHY.js";import{C as it,B as yt,a as ft,b as bt,L as Dt,p as wt,c as Ct}from"./charts-BaeV1Cpd.js";import"./utils-B9ygI19o.js";import"./localStorageService-Bm_UUCrj.js";const kt={class:"card-header"},Mt={class:"card-content"},St={class:"card-title"},xt={class:"card-value"},Bt={class:"card-footer"},Nt={class:"progress-container"},At={class:"progress-bar"},Rt={class:"progress-text"},Tt={__name:"StatsCard",props:{title:String,amount:Number,icon:String,trend:String,trendType:{type:String,default:"positive",validator:r=>["positive","negative","neutral"].includes(r)},percentage:{type:Number,default:0},color:{type:String,default:"primary",validator:r=>["primary","success","warning","danger","info"].includes(r)}},setup(r){const b=r,c=Q(()=>{const d={primary:"rgba(99, 102, 241, 0.1)",success:"rgba(34, 197, 94, 0.1)",warning:"rgba(245, 158, 11, 0.1)",danger:"rgba(239, 68, 68, 0.1)",info:"rgba(59, 130, 246, 0.1)"};return d[b.color]||d.primary});return Q(()=>{const d={primary:"var(--primary-400)",success:"var(--success-400)",warning:"var(--warning-400)",danger:"var(--danger-400)",info:"var(--info-400)"};return d[b.color]||d.primary}),(d,k)=>(p(),g("div",{class:et(["stats-card",r.color])},[t("div",kt,[t("div",{class:"card-icon",style:M({background:c.value})},n(r.icon),5),t("div",{class:et(["card-trend",r.trendType])},n(r.trend),3)]),t("div",Mt,[t("h3",St,n(r.title),1),t("p",xt,n(o(C)(r.amount)),1)]),t("div",Bt,[t("div",Nt,[t("div",At,[t("div",{class:"progress-fill",style:M({width:r.percentage+"%"})},null,4)]),t("span",Rt,n(r.percentage)+"% do objetivo",1)])])],2))}},K=ct(Tt,[["__scopeId","data-v-b593d2b2"]]),Lt=()=>{const r=f(!1),b=f(null),c=f(new Date().getMonth()+1),d=f(new Date().getFullYear()),k=Q(()=>new Date(d.value,c.value-1,1).toLocaleDateString("pt-BR",{month:"long"})),F=Q(()=>d.value),{categories:V,fetchCategories:Y}=pt(),{goals:G,fetchGoals:R}=ht(),{cards:j,fetchCards:q}=_t(),P=f(0),T=f({income:0,expenses:0,savings:0,investments:0}),S=f([]),x=f([]),z=f([]),L=f([]),s=f({labels:[],datasets:[{label:"Receita",backgroundColor:"#10b981",data:[]},{label:"Despesa",backgroundColor:"#ef4444",data:[]}]}),u=(i,v)=>{const h=new Date(i,v-1,1),I=new Date(i,v,0,23,59,59,999);return{startDate:h,endDate:I}},a=i=>{let v=[];return Array.isArray(i.data)?v=i.data:i.data&&Array.isArray(i.data.transactions)?v=i.data.transactions:i.data&&Array.isArray(i.data.data)&&(v=i.data.data),v.map(h=>({...h,id:h._id||h.id,_id:h._id||h.id}))},st=async(i,v)=>{const h=await rt.get("/transactions",{startDate:i.toISOString(),endDate:v.toISOString(),limit:1e3});return a(h)},O=async()=>{r.value=!0,b.value=null;try{const{startDate:i,endDate:v}=u(d.value,c.value),h=new Date(d.value,c.value-1-11,1),I=v,[$,U,W]=await Promise.all([rt.get("/transactions/stats/monthly",{month:c.value,year:d.value}),st(i,v),st(h,I),Y(),R(),q()]),D=($==null?void 0:$.data)||{};T.value={income:D.totalIncome||0,expenses:D.totalExpenses||0,savings:D.netBalance||0,investments:D.totalInvestments||0},P.value=D.netBalance||0,dt(U,W)}catch(i){b.value="Falha ao carregar dados do dashboard.",console.error("Erro ao buscar dados do dashboard:",i)}finally{r.value=!1}},dt=(i,v)=>{const h=V.value||[],I=G.value||[],$=j.value||[];S.value=[...i].sort((e,l)=>new Date(l.date)-new Date(e.date)).slice(0,5).map(e=>{let l=null;return typeof e.category=="object"&&e.category!==null?l=e.category:l=h.find(m=>m._id===e.category||m.id===e.category||m.name===e.category),{...e,id:e._id||e.id,icon:(l==null?void 0:l.icon)||"ðŸ’¸",categoryColor:(l==null?void 0:l.color)||"#808080",category:(l==null?void 0:l.name)||e.category||"Sem categoria"}}),x.value=I.slice(0,3).map(e=>({...e,id:e._id||e.id,percentage:e.targetAmount>0?(e.currentAmount/e.targetAmount*100).toFixed(0):0,current:e.currentAmount||0,target:e.targetAmount||0,icon:e.icon||"ðŸŽ¯",color:e.color||"#6366f1"}));const U=T.value.expenses||0,W=h.filter(e=>e.type==="expense").map(e=>{const l=i.filter(m=>{var Z,_;const N=typeof m.category=="object"?((Z=m.category)==null?void 0:Z._id)||((_=m.category)==null?void 0:_.id):m.category,X=e._id||e.id;return m.type==="expense"&&(N===X||m.category===e.name)}).reduce((m,N)=>m+Math.abs(N.amount),0);return{id:e._id||e.id,name:e.name,amount:l,color:e.color,percentage:U>0?(l/U*100).toFixed(0):0}}).filter(e=>e.amount>0).sort((e,l)=>l.amount-e.amount);z.value=W,L.value=$.slice(0,3).map(e=>({...e,id:e._id||e.id,dueDate:e.dueDate?new Date(e.dueDate).toLocaleDateString("pt-BR",{day:"2-digit",month:"2-digit"}):"N/A",color:e.color?`linear-gradient(135deg, ${e.color}, ${It(e.color,-40)})`:"linear-gradient(135deg, #6366f1, #4f46e5)"}));const D=[],at=[],ot=[],B=new Date(d.value,c.value-1,1);for(let e=11;e>=0;e--){const l=new Date(B.getFullYear(),B.getMonth()-e,1);D.push(l.toLocaleDateString("pt-BR",{month:"short"}));const m=new Date(B.getFullYear(),B.getMonth()-e,1),N=new Date(B.getFullYear(),B.getMonth()-e+1,0),X=(v||[]).filter(_=>_.type==="income"&&new Date(_.date)>=m&&new Date(_.date)<=N).reduce((_,tt)=>_+Math.abs(tt.amount),0),Z=(v||[]).filter(_=>_.type==="expense"&&new Date(_.date)>=m&&new Date(_.date)<=N).reduce((_,tt)=>_+Math.abs(tt.amount),0);at.push(X),ot.push(Z)}s.value.labels=D,s.value.datasets[0].data=at,s.value.datasets[1].data=ot};return lt(O),{loading:r,error:b,totalBalance:P,stats:T,recentTransactions:S,goals:x,categories:z,creditCards:L,chartData:s,fetchData:O,goToPreviousMonth:()=>{c.value===1?(c.value=12,d.value-=1):c.value-=1,O()},goToNextMonth:()=>{c.value===12?(c.value=1,d.value+=1):c.value+=1,O()},currentMonthName:k,currentYear:F}};function It(r,b){return r?"#"+r.replace(/^#/,"").replace(/../g,c=>("0"+Math.min(255,Math.max(0,parseInt(c,16)+b)).toString(16)).substr(-2)):"#000000"}const $t={class:"dashboard"},Et={class:"welcome-section"},Ft={class:"welcome-content"},Vt={class:"welcome-title"},Yt={class:"text-gradient"},Gt={class:"welcome-stats"},jt={key:0,class:"stat-badge"},qt={class:"stat-value"},Pt={class:"quick-actions-grid"},zt={class:"month-navigator"},Ot={class:"month-title"},Ut={class:"stats-grid"},Zt={class:"content-grid"},Ht={class:"chart-section card"},Jt={class:"chart-container"},Kt={class:"transactions-section card"},Qt={class:"section-header"},Wt={class:"transactions-list"},Xt={key:0,class:"empty-data"},te={class:"transaction-details"},ee={class:"transaction-meta"},se={class:"bottom-grid"},ae={class:"goals-section card"},oe={class:"section-header"},ne={class:"goals-list"},re={key:0,class:"empty-data"},ie={class:"goal-info"},le={class:"goal-deadline"},ce={class:"goal-progress"},de={class:"progress-info"},ue={class:"progress-percentage"},ve={class:"progress-bar"},me={class:"categories-section card"},ge={class:"section-header"},pe={class:"categories-list"},he={key:0,class:"empty-data"},_e={class:"category-info"},ye={class:"category-name"},fe={class:"category-details"},be={class:"category-amount"},De={class:"category-percentage"},we={class:"cards-section"},Ce={class:"section-header"},ke={class:"cards-grid"},Me={key:0,class:"empty-data-full"},Se={class:"card-header"},xe={class:"card-type"},Be={class:"card-number"},Ne={class:"card-footer"},Ae={class:"card-info"},Re={class:"card-name"},Te={class:"card-due"},Le={class:"card-balance"},Ie={class:"balance-amount"},$e={__name:"Dashboard",setup(r){it.register(yt,ft,bt,Dt,wt,Ct),mt();const b=gt(),{loading:c,totalBalance:d,stats:k,recentTransactions:F,goals:V,categories:Y,creditCards:G,chartData:R,goToPreviousMonth:j,goToNextMonth:q,currentMonthName:P,currentYear:T}=Lt(),S=f(null);let x=null;const z=()=>{if(x&&x.destroy(),S.value&&R.value){const L=S.value.getContext("2d");x=new it(L,{type:"bar",data:R.value,options:{responsive:!0,maintainAspectRatio:!1,scales:{y:{beginAtZero:!0}},plugins:{tooltip:{callbacks:{label:function(s){let u=s.dataset.label||"";return u&&(u+=": "),s.parsed.y!==null&&(u+=C(s.parsed.y,"BRL")),u}}}}}})}};return lt(()=>{b.fetchUser()}),ut(R,()=>{z()},{deep:!0}),(L,s)=>{const u=vt("router-link");return p(),g("div",$t,[t("div",Et,[t("div",Ft,[t("h1",Vt,[s[2]||(s[2]=A(" OlÃ¡, ",-1)),t("span",Yt,n(o(b).userName),1),s[3]||(s[3]=A("! ðŸ‘‹ ",-1))]),s[4]||(s[4]=t("p",{class:"welcome-subtitle"},"Acompanhe suas finanÃ§as em tempo real",-1))]),t("div",Gt,[o(c)?E("",!0):(p(),g("div",jt,[s[5]||(s[5]=t("span",{class:"stat-label"},"Saldo do MÃªs",-1)),t("span",qt,n(o(C)(o(d),"BRL")),1)]))])]),t("div",Pt,[y(u,{to:"/transactions",class:"quick-action"},{default:w(()=>[...s[6]||(s[6]=[t("div",{class:"action-icon add"},"+",-1),t("span",{class:"action-label"},"Nova TransaÃ§Ã£o",-1)])]),_:1}),y(u,{to:"/reports",class:"quick-action"},{default:w(()=>[...s[7]||(s[7]=[t("div",{class:"action-icon report"},"ðŸ“Š",-1),t("span",{class:"action-label"},"Gerar RelatÃ³rio",-1)])]),_:1}),y(u,{to:"/goals",class:"quick-action"},{default:w(()=>[...s[8]||(s[8]=[t("div",{class:"action-icon goal"},"ðŸŽ¯",-1),t("span",{class:"action-label"},"Minhas Metas",-1)])]),_:1}),y(u,{to:"/currency",class:"quick-action"},{default:w(()=>[...s[9]||(s[9]=[t("div",{class:"action-icon currency"},"ðŸŒŽ",-1),t("span",{class:"action-label"},"CÃ¢mbio",-1)])]),_:1})]),t("div",zt,[t("button",{onClick:s[0]||(s[0]=(...a)=>o(j)&&o(j)(...a)),class:"nav-button"},"â€¹"),t("h2",Ot,n(o(P))+" de "+n(o(T)),1),t("button",{onClick:s[1]||(s[1]=(...a)=>o(q)&&o(q)(...a)),class:"nav-button"},"â€º")]),t("div",Ut,[y(K,{title:"Receita do MÃªs",amount:o(k).income,icon:"ðŸ’°","trend-type":"positive"},null,8,["amount"]),y(K,{title:"Despesas do MÃªs",amount:o(k).expenses,icon:"ðŸ’¸","trend-type":"negative",color:"danger"},null,8,["amount"]),y(K,{title:"Saldo do MÃªs",amount:o(k).savings,icon:"ðŸ¦","trend-type":"positive",color:"success"},null,8,["amount"]),y(K,{title:"Investimentos",amount:o(k).investments,icon:"ðŸ“ˆ","trend-type":"positive",color:"warning"},null,8,["amount"])]),t("div",Zt,[t("div",Ht,[s[10]||(s[10]=t("div",{class:"section-header"},[t("h3",null,"Receitas vs Despesas")],-1)),t("div",Jt,[t("canvas",{ref_key:"chartCanvas",ref:S},null,512)])]),t("div",Kt,[t("div",Qt,[s[12]||(s[12]=t("h3",null,"TransaÃ§Ãµes Recentes no MÃªs",-1)),y(u,{to:"/transactions",class:"view-all"},{default:w(()=>[...s[11]||(s[11]=[A(" Ver todas ",-1),t("span",{class:"arrow"},"â†’",-1)])]),_:1})]),t("div",Wt,[o(F).length===0?(p(),g("div",Xt," Nenhuma transaÃ§Ã£o neste mÃªs. ")):E("",!0),(p(!0),g(H,null,J(o(F),a=>(p(),g("div",{key:a.id,class:"transaction-item"},[t("div",{class:"transaction-icon",style:M({background:a.categoryColor})},n(a.icon),5),t("div",te,[t("h4",null,n(a.description),1),t("p",ee,n(a.category)+" â€¢ "+n(o(nt)(a.date)),1)]),t("div",{class:et(["transaction-amount",a.type])},n(a.type==="income"?"+":"-")+" "+n(o(C)(Math.abs(a.amount),"BRL")),3)]))),128))])])]),t("div",se,[t("div",ae,[t("div",oe,[s[14]||(s[14]=t("h3",null,"Metas em Andamento",-1)),y(u,{to:"/goals",class:"view-all"},{default:w(()=>[...s[13]||(s[13]=[A(" Ver todas ",-1),t("span",{class:"arrow"},"â†’",-1)])]),_:1})]),t("div",ne,[o(V).length===0?(p(),g("div",re," Nenhuma meta em andamento. ")):E("",!0),(p(!0),g(H,null,J(o(V),a=>(p(),g("div",{key:a.id,class:"goal-item"},[t("div",ie,[t("div",{class:"goal-icon",style:M({background:a.color})},n(a.icon),5),t("div",null,[t("h4",null,n(a.name),1),t("p",le,n(o(nt)(a.deadline)),1)])]),t("div",ce,[t("div",de,[t("span",null,n(o(C)(a.current,"BRL"))+" / "+n(o(C)(a.target,"BRL")),1),t("span",ue,n(a.percentage)+"%",1)]),t("div",ve,[t("div",{class:"progress-fill",style:M({width:a.percentage+"%",background:a.color})},null,4)])])]))),128))])]),t("div",me,[t("div",ge,[s[16]||(s[16]=t("h3",null,"Gastos por Categoria (MÃªs)",-1)),y(u,{to:"/categories",class:"view-all"},{default:w(()=>[...s[15]||(s[15]=[A(" Ver todas ",-1),t("span",{class:"arrow"},"â†’",-1)])]),_:1})]),t("div",pe,[o(Y).length===0?(p(),g("div",he," Nenhum gasto este mÃªs. ")):E("",!0),(p(!0),g(H,null,J(o(Y),a=>(p(),g("div",{key:a.id,class:"category-item"},[t("div",_e,[t("div",{class:"category-color",style:M({background:a.color})},null,4),t("span",ye,n(a.name),1)]),t("div",fe,[t("span",be,n(o(C)(a.amount,"BRL")),1),t("span",De,n(a.percentage)+"%",1)])]))),128))])])]),t("div",we,[t("div",Ce,[s[18]||(s[18]=t("h3",null,"CartÃµes de CrÃ©dito",-1)),y(u,{to:"/credit-cards",class:"view-all"},{default:w(()=>[...s[17]||(s[17]=[A(" Gerenciar cartÃµes ",-1),t("span",{class:"arrow"},"â†’",-1)])]),_:1})]),t("div",ke,[o(G).length===0?(p(),g("div",Me," Nenhum cartÃ£o de crÃ©dito cadastrado. ")):E("",!0),(p(!0),g(H,null,J(o(G),a=>(p(),g("div",{key:a.id,class:"credit-card",style:M({background:a.color})},[t("div",Se,[t("div",xe,n(a.type),1),s[19]||(s[19]=t("div",{class:"card-chip"},"ðŸ’³",-1))]),t("div",Be,n(a.number),1),t("div",Ne,[t("div",Ae,[t("div",Re,n(a.name),1),t("div",Te,"Vence: "+n(a.dueDate),1)]),t("div",Le,[s[20]||(s[20]=t("div",{class:"balance-label"},"Saldo",-1)),t("div",Ie,n(o(C)(a.balance,"BRL")),1)])])],4))),128))])])])}}},Ze=ct($e,[["__scopeId","data-v-18f56ebe"]]);export{Ze as default};
