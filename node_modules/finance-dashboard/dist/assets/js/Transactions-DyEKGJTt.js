import{d as O,r as T,c as F,o as J,a as v,e,b as V,t as m,f as S,E as A,I as E,F as I,A as U,z as g,D as Y,J as G,m as y,n as $}from"./vendor-BNDw7TD6.js";import{a as D,_ as H}from"./index-Cwx_woFl.js";import{u as K}from"./category-C_8PkLCj.js";import{a as Q,f as W}from"./formatters-B8MMj10x.js";import"./utils-B9ygI19o.js";const X=O("transaction",()=>{const c=T([]);return{transactions:c,setTransactions:p=>{c.value=p},addTransaction:p=>{c.value.unshift(p)},deleteTransaction:p=>{c.value=c.value.filter(b=>b.id!==p)},updateTransaction:(p,b)=>{const C=c.value.findIndex(s=>s.id===p);C!==-1&&(c.value[C]={...c.value[C],...b})}}}),Z=()=>{const c=X(),l=T(!1),d=T(null),h=async(s={})=>{var i,r;l.value=!0,d.value=null;try{const o=await D.get("/transactions",{params:s});Array.isArray(o.data)?c.setTransactions(o.data):o.data&&Array.isArray(o.data.data)&&c.setTransactions(o.data.data)}catch(o){d.value=((r=(i=o.response)==null?void 0:i.data)==null?void 0:r.message)||"Failed to fetch transactions",console.error("Erro ao buscar transações:",o)}finally{l.value=!1}},x=async s=>{var i,r;l.value=!0,d.value=null;try{const o=await D.post("/transactions",s);return c.addTransaction(o.data),o.data}catch(o){throw d.value=((r=(i=o.response)==null?void 0:i.data)==null?void 0:r.message)||"Failed to add transaction",o}finally{l.value=!1}},p=async(s,i)=>{var r,o;l.value=!0,d.value=null;try{const f=await D.put(`/transactions/${s}`,i);return c.updateTransaction(s,f.data),f.data}catch(f){throw d.value=((o=(r=f.response)==null?void 0:r.data)==null?void 0:o.message)||"Failed to update transaction",f}finally{l.value=!1}},b=async s=>{var i,r;l.value=!0,d.value=null;try{await D.delete(`/transactions/${s}`),c.deleteTransaction(s)}catch(o){throw d.value=((r=(i=o.response)==null?void 0:i.data)==null?void 0:r.message)||"Failed to delete transaction",o}finally{l.value=!1}},C=async()=>{var s,i;l.value=!0,d.value=null;try{return(await D.get("/transactions/stats/summary")).data}catch(r){throw d.value=((i=(s=r.response)==null?void 0:s.data)==null?void 0:i.message)||"Failed to fetch transaction stats",r}finally{l.value=!1}};return{transactions:F(()=>c.transactions),loading:l,error:d,fetchTransactions:h,addTransaction:x,updateTransaction:p,deleteTransaction:b,getTransactionStats:C}},ee={class:"transactions"},ae={class:"controls"},te={key:0,class:"transaction-form card"},ne={class:"form-group"},oe={class:"form-group"},se={class:"form-group"},re={class:"form-group"},le={key:0},ie=["value"],ue={key:1},ce={class:"form-group"},de=["disabled"],pe={key:1,class:"loading"},ve={key:2,class:"error"},me={class:"transactions-list"},ye=["onClick"],fe={__name:"Transactions",props:{transactionType:{type:String,default:null}},setup(c){const l=c,{transactions:d,loading:h,error:x,fetchTransactions:p,addTransaction:b,deleteTransaction:C}=Z(),s=K(),i=T(!1),r=T(!1),o=T(!1),f=T(null),N=F(()=>l.transactionType==="income"?"Receitas":l.transactionType==="expense"?"Despesas":"Transações"),B=F(()=>{const u=(d.value||[]).filter(a=>a&&a.id);return l.transactionType?u.filter(a=>a.type===l.transactionType):u}),L=F(()=>{const u=["Mercado","Transporte/Uber","Assinaturas","Remédios","Seguro de Celular","Shopping","Condomínio","Psicologia","Convênio","Plano Funerário","Enel","Financiamento","Internet","Lazer","Celular","Outros"],a=s.categories?s.categories.map(w=>w.name):[],t=B.value.map(w=>w.category);return[...new Set([...u,...a,...t].filter(Boolean))].sort()}),M=()=>{const u=new Date,a=u.getFullYear(),t=String(u.getMonth()+1).padStart(2,"0"),_=String(u.getDate()).padStart(2,"0");return`${a}-${t}-${_}`},n=T({description:"",amount:0,type:l.transactionType||"expense",category:"",date:M()});J(async()=>{await p(),s.fetchCategories&&await s.fetchCategories()});const R=async()=>{var u;n.value.category==="__new__"&&(o.value=!0,n.value.category="",await G(),(u=f.value)==null||u.focus())},z=()=>{o.value=!1,n.value.category=""},j=async()=>{if(!n.value.date){alert("Por favor, selecione uma data válida.");return}i.value=!0;try{const[u,a,t]=n.value.date.split("-").map(Number),_=new Date(u,a-1,t,12,0,0);let w=n.value.category;const q=(s.categories||[]).find(k=>k.name===n.value.category);if(q)w=q.id;else if(n.value.category){const k=await s.createCategory({name:n.value.category,type:n.value.type});k&&k.id&&(w=k.id)}await b({...n.value,category:w,date:_,amount:n.value.type==="expense"?-Math.abs(n.value.amount):Math.abs(n.value.amount)}),n.value={description:"",amount:0,type:"expense",category:"",date:M()},o.value=!1,r.value=!1}catch(u){console.error("Error adding transaction:",u),alert("Erro ao adicionar transação. Verifique os dados e tente novamente.")}finally{i.value=!1}},P=async u=>{confirm("Tem certeza que deseja excluir esta transação?")&&await C(u)};return(u,a)=>(y(),v("div",ee,[e("h1",null,m(N.value),1),e("div",ae,[e("button",{onClick:a[0]||(a[0]=t=>r.value=!r.value),class:"btn btn-primary"},m(r.value?"Cancelar":"Adicionar Transação"),1)]),r.value?(y(),v("div",te,[a[15]||(a[15]=e("h3",null,"Adicionar Nova Transação",-1)),e("form",{onSubmit:Y(j,["prevent"])},[e("div",ne,[a[7]||(a[7]=e("label",null,"Descrição",-1)),S(e("input",{"onUpdate:modelValue":a[1]||(a[1]=t=>n.value.description=t),type:"text",required:"",class:"form-control"},null,512),[[A,n.value.description]])]),e("div",oe,[a[8]||(a[8]=e("label",null,"Valor",-1)),S(e("input",{"onUpdate:modelValue":a[2]||(a[2]=t=>n.value.amount=t),type:"number",step:"0.01",required:"",class:"form-control"},null,512),[[A,n.value.amount,void 0,{number:!0}]])]),e("div",se,[a[10]||(a[10]=e("label",null,"Tipo",-1)),S(e("select",{"onUpdate:modelValue":a[3]||(a[3]=t=>n.value.type=t),class:"form-control"},[...a[9]||(a[9]=[e("option",{value:"income"},"Receita",-1),e("option",{value:"expense"},"Despesa",-1)])],512),[[E,n.value.type]])]),e("div",re,[a[13]||(a[13]=e("label",null,"Categoria",-1)),o.value?(y(),v("div",ue,[S(e("input",{"onUpdate:modelValue":a[5]||(a[5]=t=>n.value.category=t),type:"text",required:"",class:"form-control",placeholder:"Nome da categoria",ref_key:"customCategoryInput",ref:f},null,512),[[A,n.value.category]]),e("button",{type:"button",onClick:z,class:"btn-link"},"Selecionar existente")])):(y(),v("div",le,[S(e("select",{"onUpdate:modelValue":a[4]||(a[4]=t=>n.value.category=t),class:"form-control",onChange:R,required:""},[a[11]||(a[11]=e("option",{value:"",disabled:""},"Selecione uma categoria",-1)),(y(!0),v(I,null,U(L.value,t=>(y(),v("option",{key:t,value:t},m(t),9,ie))),128)),a[12]||(a[12]=e("option",{value:"__new__"},"+ Nova Categoria",-1))],544),[[E,n.value.category]])]))]),e("div",ce,[a[14]||(a[14]=e("label",null,"Data",-1)),S(e("input",{"onUpdate:modelValue":a[6]||(a[6]=t=>n.value.date=t),type:"date",required:"",class:"form-control"},null,512),[[A,n.value.date]])]),e("button",{type:"submit",disabled:g(h)||i.value,class:"btn btn-primary"},m(g(h)||i.value?"Adicionando...":"Adicionar Transação"),9,de)],32)])):V("",!0),g(h)?(y(),v("div",pe,"Carregando...")):V("",!0),g(x)?(y(),v("div",ve,m(g(x)),1)):V("",!0),e("div",me,[e("table",null,[a[16]||(a[16]=e("thead",null,[e("tr",null,[e("th",null,"Data"),e("th",null,"Descrição"),e("th",null,"Categoria"),e("th",null,"Tipo"),e("th",null,"Valor"),e("th",null,"Ações")])],-1)),e("tbody",null,[(y(!0),v(I,null,U(g(d),t=>(y(),v("tr",{key:t.id},[e("td",null,m(g(Q)(t.date)),1),e("td",null,m(t.description||"Sem descrição"),1),e("td",null,m(t.category),1),e("td",null,[e("span",{class:$(["type-badge",t.type])},m(t.type==="income"?"Receita":"Despesa"),3)]),e("td",{class:$({negative:t.amount<0,positive:t.amount>0})},m(g(W)(t.amount,"BRL")),3),e("td",null,[e("button",{onClick:_=>P(t.id),class:"btn btn-danger btn-sm"}," Excluir ",8,ye)])]))),128))])])])]))}},Se=H(fe,[["__scopeId","data-v-4741f346"]]);export{Se as default};
