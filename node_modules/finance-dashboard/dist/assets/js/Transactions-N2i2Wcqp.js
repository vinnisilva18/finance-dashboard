import{d as H,r as C,c as V,o as K,a as f,e as a,b as N,t as y,f as k,E as I,I as U,F as B,B as j,A as x,l as Q,J as W,p as g,n as R}from"./vendor-kE9Pwckw.js";import{a as F,_ as X}from"./index-C2foQiSO.js";import{a as Z,u as ee}from"./useCategories-CvvNYS7B.js";import{a as ae,f as te}from"./formatters-B8MMj10x.js";import"./utils-B9ygI19o.js";const ne=H("transaction",()=>{const i=C([]);return{transactions:i,setTransactions:v=>{i.value=v},addTransaction:v=>{i.value.unshift(v)},deleteTransaction:v=>{i.value=i.value.filter(w=>w.id!==v)},updateTransaction:(v,w)=>{const _=i.value.findIndex(r=>r.id===v);_!==-1&&(i.value[_]={...i.value[_],...w})}}}),se=()=>{const i=ne(),l=C(!1),p=C(null),D=async(r={})=>{var c,u;l.value=!0,p.value=null;try{const n=await F.get("/transactions",{params:r});let d=[];Array.isArray(n.data)?d=n.data:n.data&&Array.isArray(n.data.transactions)?d=n.data.transactions:n.data&&Array.isArray(n.data.data)&&(d=n.data.data);const S=d.map(m=>({...m,id:m._id||m.id,_id:m._id||m.id}));i.setTransactions(S)}catch(n){p.value=((u=(c=n.response)==null?void 0:c.data)==null?void 0:u.message)||"Failed to fetch transactions",console.error("Erro ao buscar transações:",n),i.setTransactions([])}finally{l.value=!1}},A=async r=>{var c,u;l.value=!0,p.value=null;try{const n=await F.post("/transactions",r);return i.addTransaction(n.data),n.data}catch(n){throw p.value=((u=(c=n.response)==null?void 0:c.data)==null?void 0:u.message)||"Failed to add transaction",n}finally{l.value=!1}},v=async(r,c)=>{var u,n;l.value=!0,p.value=null;try{const d=await F.put(`/transactions/${r}`,c);return i.updateTransaction(r,d.data),d.data}catch(d){throw p.value=((n=(u=d.response)==null?void 0:u.data)==null?void 0:n.message)||"Failed to update transaction",d}finally{l.value=!1}},w=async r=>{var c,u;if(!r||r==="undefined"){const n="Invalid transaction ID";throw console.error(n,r),new Error(n)}l.value=!0,p.value=null;try{await F.delete(`/transactions/${r}`),i.deleteTransaction(r)}catch(n){throw p.value=((u=(c=n.response)==null?void 0:c.data)==null?void 0:u.message)||"Failed to delete transaction",n}finally{l.value=!1}},_=async()=>{var r,c;l.value=!0,p.value=null;try{return(await F.get("/transactions/stats/summary")).data}catch(u){throw p.value=((c=(r=u.response)==null?void 0:r.data)==null?void 0:c.message)||"Failed to fetch transaction stats",u}finally{l.value=!1}};return{transactions:V(()=>i.transactions),loading:l,error:p,fetchTransactions:D,addTransaction:A,updateTransaction:v,deleteTransaction:w,getTransactionStats:_}},oe={class:"transactions"},re={class:"controls"},le={key:0,class:"transaction-form card"},ie={class:"form-group"},ue={class:"form-group"},de={class:"form-group"},ce={class:"form-group"},pe={key:0},ve=["value"],me={key:1},fe={class:"form-group"},ye=["disabled"],ge={key:1,class:"loading"},Te={key:2,class:"error"},be={class:"transactions-list"},Ce=["onClick"],we={__name:"Transactions",props:{transactionType:{type:String,default:null}},setup(i){const l=i,{transactions:p,loading:D,error:A,fetchTransactions:v,addTransaction:w,deleteTransaction:_}=se(),r=Z(),{fetchCategories:c,addCategory:u}=ee(),n=s=>{if(!s)return"Sem Categoria";if(typeof s=="object"&&s!==null&&s.name)return s.name;if(typeof s!="string")return"Inválida";const e=r.categories.find(T=>T.id===s||T._id===s);return e?e.name:/^[0-9a-fA-F]{24}$/.test(s)?"Sem Categoria":s},d=C(!1),S=C(!1),m=C(!1),$=C(null),z=V(()=>l.transactionType==="income"?"Receitas":l.transactionType==="expense"?"Despesas":"Transações"),q=V(()=>{const s=(p.value||[]).filter(e=>e&&(e.id||e._id));return l.transactionType?s.filter(e=>e.type===l.transactionType):s}),O=V(()=>{const s=["Mercado","Transporte/Uber","Assinaturas","Remédios","Seguro de Celular","Shopping","Condomínio","Psicologia","Convênio","Plano Funerário","Enel","Financiamento","Internet","Lazer","Celular","Outros"],e=r.categories?r.categories.map(b=>b.name):[],t=q.value.map(b=>n(b.category));return[...new Set([...s,...e,...t].filter(Boolean))].sort()}),L=()=>{const s=new Date,e=s.getFullYear(),t=String(s.getMonth()+1).padStart(2,"0"),T=String(s.getDate()).padStart(2,"0");return`${e}-${t}-${T}`},o=C({description:"",amount:0,type:l.transactionType||"expense",category:"",date:L()});K(async()=>{await v(),await c()});const P=async()=>{var s;o.value.category==="__new__"&&(m.value=!0,o.value.category="",await W(),(s=$.value)==null||s.focus())},J=()=>{m.value=!1,o.value.category=""},Y=async()=>{if(!o.value.date){alert("Por favor, selecione uma data válida.");return}d.value=!0;try{const[s,e,t]=o.value.date.split("-").map(Number),T=new Date(s,e-1,t,12,0,0);let b=null;const M=o.value.category;if(!M){alert("Por favor, selecione ou crie uma categoria."),d.value=!1;return}const E=r.categories.find(h=>h.name.toLowerCase()===M.toLowerCase());if(E)b=E._id||E.id;else{const h=await u({name:M,type:o.value.type});h&&(h._id||h.id)&&(b=h._id||h.id)}if(!b){alert("Ocorreu um erro ao processar a categoria. Tente novamente."),d.value=!1;return}await w({...o.value,category:b,date:T,amount:o.value.type==="expense"?-Math.abs(o.value.amount):Math.abs(o.value.amount)}),o.value={description:"",amount:0,type:"expense",category:"",date:L()},m.value=!1,S.value=!1}catch(s){console.error("Error adding transaction:",s),alert("Erro ao adicionar transação. Verifique os dados e tente novamente.")}finally{d.value=!1}},G=async s=>{confirm("Tem certeza que deseja excluir esta transação?")&&await _(s)};return(s,e)=>(g(),f("div",oe,[a("h1",null,y(z.value),1),a("div",re,[a("button",{onClick:e[0]||(e[0]=t=>S.value=!S.value),class:"btn btn-primary"},y(S.value?"Cancelar":"Adicionar Transação"),1)]),S.value?(g(),f("div",le,[e[15]||(e[15]=a("h3",null,"Adicionar Nova Transação",-1)),a("form",{onSubmit:Q(Y,["prevent"])},[a("div",ie,[e[7]||(e[7]=a("label",null,"Descrição",-1)),k(a("input",{"onUpdate:modelValue":e[1]||(e[1]=t=>o.value.description=t),type:"text",required:"",class:"form-control"},null,512),[[I,o.value.description]])]),a("div",ue,[e[8]||(e[8]=a("label",null,"Valor",-1)),k(a("input",{"onUpdate:modelValue":e[2]||(e[2]=t=>o.value.amount=t),type:"number",step:"0.01",required:"",class:"form-control"},null,512),[[I,o.value.amount,void 0,{number:!0}]])]),a("div",de,[e[10]||(e[10]=a("label",null,"Tipo",-1)),k(a("select",{"onUpdate:modelValue":e[3]||(e[3]=t=>o.value.type=t),class:"form-control"},[...e[9]||(e[9]=[a("option",{value:"income"},"Receita",-1),a("option",{value:"expense"},"Despesa",-1)])],512),[[U,o.value.type]])]),a("div",ce,[e[13]||(e[13]=a("label",null,"Categoria",-1)),m.value?(g(),f("div",me,[k(a("input",{"onUpdate:modelValue":e[5]||(e[5]=t=>o.value.category=t),type:"text",required:"",class:"form-control",placeholder:"Nome da categoria",ref_key:"customCategoryInput",ref:$},null,512),[[I,o.value.category]]),a("button",{type:"button",onClick:J,class:"btn-link"},"Selecionar existente")])):(g(),f("div",pe,[k(a("select",{"onUpdate:modelValue":e[4]||(e[4]=t=>o.value.category=t),class:"form-control",onChange:P,required:""},[e[11]||(e[11]=a("option",{value:"",disabled:""},"Selecione uma categoria",-1)),(g(!0),f(B,null,j(O.value,t=>(g(),f("option",{key:t,value:t},y(t),9,ve))),128)),e[12]||(e[12]=a("option",{value:"__new__"},"+ Nova Categoria",-1))],544),[[U,o.value.category]])]))]),a("div",fe,[e[14]||(e[14]=a("label",null,"Data",-1)),k(a("input",{"onUpdate:modelValue":e[6]||(e[6]=t=>o.value.date=t),type:"date",required:"",class:"form-control"},null,512),[[I,o.value.date]])]),a("button",{type:"submit",disabled:x(D)||d.value,class:"btn btn-primary"},y(x(D)||d.value?"Adicionando...":"Adicionar Transação"),9,ye)],32)])):N("",!0),x(D)?(g(),f("div",ge,"Carregando...")):N("",!0),x(A)?(g(),f("div",Te,y(x(A)),1)):N("",!0),a("div",be,[a("table",null,[e[16]||(e[16]=a("thead",null,[a("tr",null,[a("th",null,"Data"),a("th",null,"Descrição"),a("th",null,"Categoria"),a("th",null,"Tipo"),a("th",null,"Valor"),a("th",null,"Ações")])],-1)),a("tbody",null,[(g(!0),f(B,null,j(q.value,t=>(g(),f("tr",{key:t._id||t.id},[a("td",null,y(x(ae)(t.date)),1),a("td",null,y(t.description||"Sem descrição"),1),a("td",null,y(n(t.category)),1),a("td",null,[a("span",{class:R(["type-badge",t.type])},y(t.type==="income"?"Receita":"Despesa"),3)]),a("td",{class:R({negative:t.amount<0,positive:t.amount>0})},y(x(te)(t.amount,"BRL")),3),a("td",null,[a("button",{onClick:T=>G(t._id||t.id),class:"btn btn-danger btn-sm"}," Excluir ",8,Ce)])]))),128))])])])]))}},ke=X(we,[["__scopeId","data-v-568905c6"]]);export{ke as default};
