import{d as R,r as m,c as k,B as P,o as T,a as N,e,h as B,t as p,D as M,f as S,E,H as I,m as V}from"./vendor-BNDw7TD6.js";import{_ as j,u as G}from"./index-Cwx_woFl.js";import{a as D}from"./utils-B9ygI19o.js";import{l as f}from"./localStorageService-Bm_UUCrj.js";const O=R("user",()=>{const g=m(null),i=m(localStorage.getItem("token")),u=m(!1),s=m(null),w=k(()=>!!i.value),y=D.create({baseURL:"/api",headers:{Authorization:i.value?`Bearer ${i.value}`:""}});async function h(o){var l,c;u.value=!0,s.value=null;try{const t=await D.post("/api/auth/login",o);return i.value=t.data.token,g.value=t.data.user,localStorage.setItem("token",i.value),t.data}catch(t){throw s.value=((c=(l=t.response)==null?void 0:l.data)==null?void 0:c.message)||"Erro ao fazer login",t}finally{u.value=!1}}async function b(o){var l,c;u.value=!0,s.value=null;try{return(await D.post("/api/auth/register",o)).data}catch(t){throw s.value=((c=(l=t.response)==null?void 0:l.data)==null?void 0:c.message)||"Erro ao registrar",t}finally{u.value=!1}}async function n(){try{await y.post("/api/auth/logout")}finally{i.value=null,g.value=null,localStorage.removeItem("token")}}async function d(){try{const o=await y.get("/api/auth/profile");g.value=o.data}catch{n()}}async function C(o){var l,c;u.value=!0,s.value=null;try{const t=await y.put("/api/auth/profile",o);return g.value=t.data,t.data}catch(t){throw s.value=((c=(l=t.response)==null?void 0:l.data)==null?void 0:c.message)||"Erro ao atualizar perfil",t}finally{u.value=!1}}return{user:g,token:i,loading:u,error:s,isAuthenticated:w,login:h,register:b,logout:n,fetchProfile:d,updateProfile:C}}),q={class:"profile"},J={class:"profile-grid"},F={class:"profile-card card"},L={class:"profile-header"},$={class:"profile-info"},H={class:"member-since"},K={class:"profile-stats"},Q={class:"stat-item"},W={class:"stat-value"},X={class:"stat-item"},Y={class:"stat-value"},Z={class:"stat-item"},ee={class:"stat-value"},ae={class:"stat-item"},te={class:"stat-value"},se={class:"settings-card card"},oe={class:"form-section"},le={class:"form-row"},re={class:"form-group"},ne={class:"form-group"},ie={class:"form-section"},ue={class:"preferences-grid"},de={class:"preference-item"},ce={class:"checkbox-label"},pe={class:"preference-item"},me={class:"checkbox-label"},ve={class:"form-actions"},fe=["disabled"],ge={class:"data-management-card card"},ye={__name:"Profile",setup(g){const i=G(),u=O(),s=k(()=>i.user||u.user),w=k(()=>{var r;return(r=s.value)!=null&&r.name?s.value.name.split(" ").map(a=>a[0]).join("").toUpperCase().slice(0,2):"U"}),y=k(()=>new Date().toLocaleDateString("pt-BR",{year:"numeric",month:"long"})),h=m("#4CAF50"),b=m(null),n=m({transactions:0,categories:0,activeGoals:0,creditCards:0}),d=P({name:"",email:""}),C=()=>{s.value&&(d.name=s.value.name||"",d.email=s.value.email||"")},o=P({notifications:!0,weeklyReports:!0}),l=m(!1);T(()=>{const r=localStorage.getItem("userPreferences");r&&Object.assign(o,JSON.parse(r));const a=localStorage.getItem("userColor");a&&(h.value=a),C(),n.value.transactions=(f.getData("transactions")||[]).length,n.value.categories=(f.getData("categories")||[]).length,n.value.activeGoals=(f.getData("goals")||[]).length,n.value.creditCards=(f.getData("cards")||[]).length});const c=async()=>{l.value=!0;try{s.value&&i.updateUser({name:d.name,email:d.email}),u.setPreferences(o),localStorage.setItem("userPreferences",JSON.stringify(o)),await new Promise(r=>setTimeout(r,1e3)),alert("Perfil atualizado com sucesso!")}catch(r){alert("Erro ao atualizar o perfil: "+r.message)}finally{l.value=!1}},t=()=>{f.exportData()},U=()=>{b.value.click()},z=async r=>{const a=r.target.files[0];if(a)try{await f.importData(a),alert("Dados importados com sucesso! A pÃ¡gina serÃ¡ recarregada."),window.location.reload()}catch(_){alert(`Erro ao importar dados: ${_.message}`)}finally{b.value.value=""}},A=()=>{confirm("Tem certeza que deseja apagar todos os dados? Esta aÃ§Ã£o nÃ£o pode ser desfeita.")&&(f.resetData(),alert("Todos os dados foram apagados. A pÃ¡gina serÃ¡ recarregada."),window.location.reload())};return(r,a)=>{var _,x;return V(),N("div",q,[a[17]||(a[17]=e("h1",null,"ConfiguraÃ§Ãµes de Perfil",-1)),e("div",J,[e("div",F,[e("div",L,[e("div",{class:"avatar",style:B({backgroundColor:h.value})},p(w.value),5),e("div",$,[e("h2",null,p(((_=s.value)==null?void 0:_.name)||"Nome do UsuÃ¡rio"),1),e("p",null,p(((x=s.value)==null?void 0:x.email)||"user@example.com"),1),e("span",H,"Membro desde "+p(y.value),1)])]),e("div",K,[e("div",Q,[a[4]||(a[4]=e("span",{class:"stat-label"},"Total de TransaÃ§Ãµes",-1)),e("span",W,p(n.value.transactions),1)]),e("div",X,[a[5]||(a[5]=e("span",{class:"stat-label"},"Categorias",-1)),e("span",Y,p(n.value.categories),1)]),e("div",Z,[a[6]||(a[6]=e("span",{class:"stat-label"},"Metas Ativas",-1)),e("span",ee,p(n.value.activeGoals),1)]),e("div",ae,[a[7]||(a[7]=e("span",{class:"stat-label"},"CartÃµes de CrÃ©dito",-1)),e("span",te,p(n.value.creditCards),1)])])]),e("div",se,[a[14]||(a[14]=e("h3",null,"ConfiguraÃ§Ãµes da Conta",-1)),e("form",{onSubmit:M(c,["prevent"])},[e("div",oe,[a[10]||(a[10]=e("h4",null,"InformaÃ§Ãµes Pessoais",-1)),e("div",le,[e("div",re,[a[8]||(a[8]=e("label",null,"Nome Completo",-1)),S(e("input",{"onUpdate:modelValue":a[0]||(a[0]=v=>d.name=v),type:"text",class:"form-control"},null,512),[[E,d.name]])]),e("div",ne,[a[9]||(a[9]=e("label",null,"EndereÃ§o de Email",-1)),S(e("input",{"onUpdate:modelValue":a[1]||(a[1]=v=>d.email=v),type:"email",class:"form-control"},null,512),[[E,d.email]])])])]),e("div",ie,[a[13]||(a[13]=e("h4",null,"PreferÃªncias",-1)),e("div",ue,[e("div",de,[e("label",ce,[S(e("input",{"onUpdate:modelValue":a[2]||(a[2]=v=>o.notifications=v),type:"checkbox"},null,512),[[I,o.notifications]]),a[11]||(a[11]=e("span",null,"NotificaÃ§Ãµes por Email",-1))])]),e("div",pe,[e("label",me,[S(e("input",{"onUpdate:modelValue":a[3]||(a[3]=v=>o.weeklyReports=v),type:"checkbox"},null,512),[[I,o.weeklyReports]]),a[12]||(a[12]=e("span",null,"RelatÃ³rios Semanais",-1))])])])]),e("div",ve,[e("button",{type:"submit",disabled:l.value,class:"btn btn-primary"},p(l.value?"Salvando...":"Salvar AlteraÃ§Ãµes"),9,fe)])],32)]),e("div",ge,[a[15]||(a[15]=e("h3",null,"Gerenciamento de Dados",-1)),a[16]||(a[16]=e("p",null,"Exporte seus dados para um arquivo JSON, importe um arquivo de backup ou restaure o aplicativo para o estado inicial.",-1)),e("input",{type:"file",ref_key:"fileInput",ref:b,onChange:z,style:{display:"none"},accept:"application/json"},null,544),e("div",{class:"data-actions"},[e("button",{onClick:t,class:"btn btn-secondary"}," ğŸ“¤ Exportar Todos os Dados "),e("button",{onClick:U,class:"btn btn-primary"}," ğŸ“¥ Importar Dados "),e("button",{onClick:A,class:"btn btn-danger"}," ğŸ—‘ï¸ Restaurar Todos os Dados ")])])])])}}},ke=j(ye,[["__scopeId","data-v-28cb3513"]]);export{ke as default};
